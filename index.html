<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
     <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Startups in Nepal - A Directory of Tech Startups in Nepal</title>
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <script src="js/handlebars/handlebars.js"></script>
    <script src="js/tabletop/src/tabletop.js"></script>
    <script src="js/jquery/jquery.js"></script>
    <script>

          var spreadsheet_key = "1Ec9Q9CD6MvRSRDtXcg7oIy9F955Llkm2_qcTmfI99Ew";

          function init() {
              Tabletop.init({
                  key: spreadsheet_key,
                  callback: showInfo,
                  simpleSheet: true
              });


          }

         // http://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array
          function shuffle(array) {
              var currentIndex = array.length, temporaryValue, randomIndex;

              // While there remain elements to shuffle...
              while (0 !== currentIndex) {

                  // Pick a remaining element...
                  randomIndex = Math.floor(Math.random() * currentIndex);
                  currentIndex -= 1;

                  // And swap it with the current element.
                  temporaryValue = array[currentIndex];
                  array[currentIndex] = array[randomIndex];
                  array[randomIndex] = temporaryValue;
              }
              return array;
          }

          function numEntries(startup) {
              var count = 0;
              for (key in startup) {
                  if (startup[key] != "") {
                      count++;
                  }
              }
              return count;
          }

          function arrange(data) {
              var hashed = {};

              //Create object of arrays with number of entries as key
              for (var i = 0; i < data.length; i++) {
                  var startup = data[i];
                  var numberOfEntries = numEntries(startup);
                  if (numberOfEntries in hashed) {
                      hashed[numberOfEntries].push(startup);
                  } else {
                      hashed[numberOfEntries] = [];
                      hashed[numberOfEntries].push(startup);
                  }
              }

              //Sort keys in ascending order to give preference to startups who have provided full information
              var entries = Object.keys(hashed);
              entries.sort(function (a, b) { return b - a });

              //Shuffle startups with same number of entries and create final listing
              var startups = [];
              for (i = 0; i < entries.length; i++) {
                  var temp = shuffle(hashed[entries[i]]);
                  startups = startups.concat(temp);
              }

              return startups;
          }

          function showInfo(data) {
              data = arrange(data);

              var source_new = $("#startup-template-new").html();
              var template_new = Handlebars.compile(source_new);
              $.each(data, function (i, startup) {
                  var html = template_new(startup);
                  $("#startups").append(html);
              });


          }

          init();

    </script>
</head>
<body>
    <div class="hero column-wrap center-align">
        <img src="images/startupsnepal_logo.png" height="200" />
        <h3>Nepali Startups Directory</h3>
        <a href="http://goo.gl/forms/pcQQAMnXoO">Add Your Startup Here</a>
    </div>

    <div class="startups-list">
    </div>


    <div class="container">
        <div class="row" id="startups">

        </div>
    </div>

    <script id="startup-template-new" type="text/x-handlebars-template">

        <div class="col-md-3">
            <div class="panel panel-primary startup">
                <div class="panel-heading">
                    <h3 class="panel-title">{{[Product Name]}}</h3>
                </div>
                <div class="panel-body">
                    <div class="row startup-row">
                        <div class="logo center-align">
                            <img src="{{[Logo URL]}}" height="{{#if NewHeight}}{{NewHeight}}{{else}}75{{/if}}" />
                        </div>
                    </div>
                    <hr/>
                    <div class="row startup-row">
                        {{[Product Tagline]}}
                    </div>
                    {{#if Founders}}
                    <div class="row startup-row startup-label-header">
                        <h4><strong>Founders</strong></h4>
                        {{Founders}}
                    </div>
                    {{/if}}                    
                    {{#if Funding}}
                    <div class="row startup-row startup-label-header">
                        <h4><strong>Funding</strong></h4>
                        {{Funding}}
                    </div>
                    {{/if}}
                    
                    {{#if Status}}
                    <div class="row startup-row startup-label-header">
                        <h4><strong>Status</strong></h4>
                        {{Status}}
                    </div>
                    {{/if}}
                    <div class="row startup-row">
                        <a href="{{[Website URL]}}">Visit Website</a>
                    </div>


                </div>
            </div>
        </div>

    </script>

    <script id="startup-template" type="text/x-handlebars-template">
        <div class="box">
            <div class="flip-container" ontouchstart="this.classList.toggle('hover');">
                <div class="flipper">
                    <div class="front center-align">
                        <img src="{{[Logo URL]}}" height="{{#if Height}}{{Height}}{{else}}75{{/if}}" />
                    </div>
                    <a href="{{[Website URL]}}">
                        <div class="back center-align column-wrap">
                            <h2>{{[Product Name]}}</h2>
                            <h5>{{[Product Tagline]}}</h5>
                            <h6>
                                VISIT WEBSITE
                            </h6>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </script>


</body>
</html>
